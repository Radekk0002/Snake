"use strict";var appleImg,rottenAppleImg,goodAppleImg,betterAppleImg,godAppleImg;function Apple(e,t,a,i,n,o){var r=this;r.x=20,r.y=16,r.appleEaten=!1,r.points=i,r.speed=n,r.appleSpeed=0,r.applePoints=0,r.ctx=e,r.appleSize=t,r.snakeSize=a,r.img=o}function Snake(s,i,p){var l=this;l.speed=250,l.bodyParts=5,l.bodyPartsHolder=[],l.direction="up",l.gameOver=!1,l.initSnake=function(){for(var e=0;e<l.bodyParts;e++)l.bodyPartsHolder.push({x:s.width/2,y:s.height/2+p*e});l.snakeListen()},l.drawSnake=function(){for(var e=0;e<l.bodyParts;e++){i.fillStyle="green";var t=l.bodyPartsHolder[e].x,a=l.bodyPartsHolder[e].y;"up"===l.direction||l.direction,i.fillRect(t+(p-(p-2-e/2))/2,a+(p-(p-2-e/2))/2,p-2-e/2,p-2-e/2)}i.fillStyle="black",i.beginPath(),i.arc(l.bodyPartsHolder[0].x+p/2-5,l.bodyPartsHolder[0].y+p/2-4,3,0,2*Math.PI,!1),i.fill(),i.fillStyle="black",i.beginPath(),i.arc(l.bodyPartsHolder[0].x+p-8,l.bodyPartsHolder[0].y+p/2-4,4,0,2*Math.PI,!1),i.fill()},l.snakeListen=function(){window.onkeydown=function(e){switch(e.keyCode){case 40:"up"!==l.direction&&(l.direction="down");break;case 38:"down"!==l.direction&&(l.direction="up");break;case 37:"right"!==l.direction&&(l.direction="left");break;case 39:"left"!==l.direction&&(l.direction="right")}}},l.updatePosition=function(){var e=l.bodyPartsHolder[0].x,t=l.bodyPartsHolder[0].y;switch(l.direction){case"up":l.bodyPartsHolder[0].y-=p;break;case"down":l.bodyPartsHolder[0].y+=p;break;case"right":l.bodyPartsHolder[0].x+=p;break;case"left":l.bodyPartsHolder[0].x-=p}for(var a=1;a<l.bodyParts;a++){var i=l.bodyPartsHolder[a].x,n=l.bodyPartsHolder[a].y;l.bodyPartsHolder[a].x=e,l.bodyPartsHolder[a].y=t,e=i,t=n}},l.moveSnake=function(){l.updatePosition(),l.drawSnake()},l.checkCollision=function(e,t){var a=l.bodyPartsHolder[0].x,i=l.bodyPartsHolder[0].y;if(a/p<e/(2*p)||i/p<t/(2*p)||(a+1)/p>(s.width-e/2)/p||(i+1)/p>(s.height-t/2)/p)l.gameOver=!0;else for(var n=1;n<l.bodyParts;n++){var o=l.bodyPartsHolder[n].x,r=l.bodyPartsHolder[n].y;if(a===o&&i===r){l.gameOver=!0;break}}},l.grow=function(){l.bodyParts++,l.bodyPartsHolder.push({x:l.bodyPartsHolder[l.bodyParts-1],y:l.bodyPartsHolder[l.bodyParts-1]})}}function Game(){var t=this;t.canvas=document.getElementById("game"),t.canvasWidth=t.canvas.width,t.canvasHeight=t.canvas.height,t.fieldWidth=t.canvasWidth-100,t.fieldHeight=t.canvasHeight-100,t.status="info",t.totalPoints=0,t.contWidthGameOver=300,t.contHeightGameOver=250,t.delayAppleAppear=2e3,t.appleSize=17,t.snakeSize=25,t.fields=[],t.randomAppleInterv,t.moveSnakeInterv,t.endGame=!1,t.canvas.getContext&&(t.ctx=t.canvas.getContext("2d"),t.startGameListen=function(e){13===e.keyCode&&(t.status="startGame",t.checkStatus()),window.removeEventListener("keypress",t.startGameListen)})}window.addEventListener("load",function(){appleImg=new Image,rottenAppleImg=new Image,goodAppleImg=new Image,betterAppleImg=new Image,godAppleImg=new Image,appleImg.src="media/apple.png",rottenAppleImg.src="media/rotten_apple.png",goodAppleImg.src="media/apple_green.png",betterAppleImg.src="media/apple_yellow.png",godAppleImg.src="media/apple_pink.png"}),Apple.prototype.apples=[],Apple.prototype.randomize=function(e){var t=this;if(0<e.length){var a=Math.floor(Math.random()*e.length),i=e[a];e.splice(a,1),t.x=i.x,t.y=i.y;var n={x:t.x,y:t.y,img:t.img,points:t.points,speed:t.speed};t.apples.push(n)}},Apple.prototype.drawApples=function(){for(var e=this,t=0;t<e.apples.length;t++){var a=e.apples[t].x,i=e.apples[t].y;e.img=e.apples[t].img,e.ctx.drawImage(e.img,e.snakeSize*a,e.snakeSize*i,e.appleSize+8,e.appleSize+8)}},Apple.prototype.checkEatenApple=function(e){var t=this;t.appleEaten=!1,t.applePoints=0;for(var a=t.appleSpeed=0;a<t.apples.length;a++)if(e.x/t.snakeSize===t.apples[a].x&&e.y/t.snakeSize===t.apples[a].y){t.applePoints=t.apples[a].points,t.appleSpeed=t.apples[a].speed,t.apples.splice(a,1),t.appleEaten=!0;break}},Game.prototype.setFields=function(i){var n=this;n.fields=[];for(var e=n.fieldWidth/n.snakeSize,o=n.fieldHeight/n.snakeSize,t=(n.canvasWidth-n.fieldWidth)/2/n.snakeSize,r=(n.canvasHeight-n.fieldHeight)/2/n.snakeSize,a=function(a){for(var e=function(t){if(!i.some(function(e){return e.x===a*n.snakeSize&&e.y===t*n.snakeSize})){var e={x:a,y:t};n.fields.push(e)}},t=r;t<o+r;t++)e(t)},s=t;s<e+t;s++)a(s)},Game.prototype.drawBackground=function(){var e=this;e.ctx.beginPath(),e.ctx.strokeStyle="rgb(15,139,141)";var t=50;e.ctx.lineWidth=t,e.ctx.moveTo(0,t/2),e.ctx.lineTo(e.canvasWidth,t/2),e.ctx.moveTo(0,e.canvasHeight-t/2),e.ctx.lineTo(e.canvasWidth,e.canvasHeight-t/2),e.ctx.stroke(),e.ctx.closePath(),e.ctx.beginPath(),t=(e.canvasWidth-e.fieldWidth)/2,e.ctx.lineWidth=t,e.ctx.moveTo(e.canvasWidth-t/2,0),e.ctx.lineTo(e.canvasWidth-t/2,e.canvasHeight),e.ctx.moveTo(t/2,0),e.ctx.lineTo(t/2,e.canvasHeight),e.ctx.stroke(),e.ctx.closePath(),e.ctx.fillStyle="orange",e.ctx.font="30px Roboto",e.ctx.fillText("Points: ".concat(e.totalPoints),100,30)},Game.prototype.drawField=function(){var e=this;e.ctx.fillStyle="rgb(20, 54, 66)",e.ctx.fillRect((e.canvasWidth-e.fieldWidth)/2,(e.canvasHeight-e.fieldHeight)/2,e.fieldWidth,e.fieldHeight)},Game.prototype.draw=function(){var t=this;!function e(){t.drawField(),t.snake.drawSnake(),t.apple.drawApples(),t.drawBackground(),t.drawID=requestAnimationFrame(e)}()},Game.prototype.shrinkCanv=function(){var t=this,a=t.fieldWidth;!function e(){t.fieldWidth===a-200&&t.contWidthGameOver+50<=a-200?t.fieldWidth=a-200:"startGame"===t.status&&t.contWidthGameOver+50<=t.fieldWidth-10&&(t.fieldWidth-=10,cancelAnimationFrame(t.drawID),t.draw(),requestAnimationFrame(e))}()},Game.prototype.startGame=function(){var e=this;e.canvas.width=e.canvasWidth,e.canvas.height=e.canvasHeight,e.fieldWidth=e.canvasWidth-100,e.fieldHeight=e.canvasHeight-100,e.totalPoints=0,Apple.prototype.apples=[],clearTimeout(e.moveTimeout),clearInterval(e.randomAppleInterv),e.timeStart=new Date,e.timeStartSec=e.timeStart.getTime()/1e3,e.drawField(),e.snake=new Snake(e.canvas,e.ctx,e.snakeSize),e.snake.initSnake(),e.setFields(e.snake.bodyPartsHolder),e.drawBackground(),e.apple=new Apple(e.ctx,e.appleSize,e.snakeSize,50,10,appleImg),e.goodApple=new Apple(e.ctx,e.appleSize,e.snakeSize,25,-10,goodAppleImg),e.rottenApple=new Apple(e.ctx,e.appleSize,e.snakeSize,-200,-50,rottenAppleImg),e.betterApple=new Apple(e.ctx,e.appleSize,e.snakeSize,70,5,betterAppleImg),e.godApple=new Apple(e.ctx,e.appleSize,e.snakeSize,175,-30,godAppleImg),e.apple.randomize(e.fields),e.randomAppleInterv=setInterval(function(){Apple.prototype.apples.length<5?(e.setFields(e.snake.bodyPartsHolder),150<=e.totalPoints&&100*Math.random()<=20?e.rottenApple.randomize(e.fields):200<=e.totalPoints&&100*Math.random()<=20?e.goodApple.randomize(e.fields):375<=e.totalPoints&&100*Math.random()<=15?e.betterApple.randomize(e.fields):575<=e.totalPoints&&100*Math.random()<=10?e.godApple.randomize(e.fields):e.apple.randomize(e.fields),cancelAnimationFrame(e.drawID)):5===e.apple.apples.length&&e.fieldWidth>=e.contWidthGameOver+50&&(Apple.prototype.apples=[],e.snake.speed=15<e.snake.speed-75?e.snake.speed-75:15,e.draw(),e.shrinkCanv())},e.delayAppleAppear),e.moveSnakeInterv=function(){e.snake.gameOver?(e.status="gameOver",e.checkStatus()):(e.drawField(),e.apple.drawApples(),e.snake.moveSnake(),e.snake.checkCollision(e.canvasWidth-e.fieldWidth,e.canvasHeight-e.fieldHeight),e.apple.checkEatenApple(e.snake.bodyPartsHolder[0]),e.apple.appleEaten&&(e.snake.grow(),e.totalPoints=0<=e.totalPoints+e.apple.applePoints?e.totalPoints+e.apple.applePoints:0,70<=e.snake.speed&&(e.snake.speed=70<e.snake.speed-e.apple.appleSpeed?e.snake.speed-e.apple.appleSpeed:70)),e.moveTimeout=setTimeout(function(){requestAnimationFrame(e.moveSnakeInterv)},e.snake.speed),e.drawBackground())},e.moveSnakeInterv()},Game.prototype.gameOver=function(){var e=this;e.timeEnd=new Date,e.timeEndSec=e.timeEnd.getTime()/1e3,e.timeSpent=Math.round(100*(e.timeEndSec-e.timeStartSec))/100;var t=e.contWidthGameOver/2.5,a=e.contWidthGameOver/8;clearInterval(e.randomAppleInterv),cancelAnimationFrame(e.drawID),e.drawField(),e.apple.drawApples(),e.snake.drawSnake(),e.drawBackground(),e.ctx.fillStyle="#DAD2D8",e.ctx.fillRect(e.canvas.width/2-e.contWidthGameOver/2,e.canvas.height/2-e.contHeightGameOver/2,e.contWidthGameOver,e.contHeightGameOver),e.ctx.strokeStyle="#0F8B8D",e.ctx.lineWidth=3,e.ctx.strokeRect(e.canvas.width/2-e.contWidthGameOver/2,e.canvas.height/2-e.contHeightGameOver/2,e.contWidthGameOver,e.contHeightGameOver),e.ctx.font="40px Roboto",e.ctx.fillStyle="black",e.ctx.fillText("Game Over!",e.canvas.width/2-80,e.canvas.height/2-e.contHeightGameOver/2+40,165),e.ctx.font="25px Roboto",e.ctx.fillText("Your points: ".concat(e.totalPoints),e.canvas.width/2-t,e.canvas.height/2-a),e.ctx.fillText("Your time: ".concat(e.timeSpent,"s"),e.canvas.width/2-t,e.canvas.height/2-a+28),e.ctx.lineWidth=3,e.ctx.strokeRect(e.canvas.width/2-e.contWidthGameOver/2,e.canvas.height/2+e.contHeightGameOver/4,e.contWidthGameOver,e.contHeightGameOver/4),e.ctx.font="30px Roboto",e.ctx.fillText("Restart Game ( Enter )",e.canvas.width/2-125,e.canvas.height/2+e.contHeightGameOver/2-e.contHeightGameOver/8+7.5,250),window.addEventListener("keypress",e.startGameListen)},Game.prototype.info=function(){var e=this;e.drawField(),e.drawBackground(),e.ctx.fillStyle="#DAD2D8",e.ctx.fillRect(e.canvas.width/2-200,e.canvas.height/2-150,400,300),e.ctx.strokeStyle="#0F8B8D",e.ctx.lineWidth=3,e.ctx.strokeRect(e.canvas.width/2-200,e.canvas.height/2-150,400,300),e.ctx.font="40px Roboto",e.ctx.fillStyle="black",e.ctx.fillText("Snake!!!",e.canvas.width/2-65,e.canvas.height/2-110,130),e.ctx.font="25px Roboto",e.ctx.fillText("Control:",e.canvas.width/2-175,e.canvas.height/2-70),e.ctx.fillText("Instructions:",e.canvas.width/2-175,e.canvas.height/2-70+46),e.ctx.font="18px Roboto",e.ctx.fillText("- Arrows on keyboard",e.canvas.width/2-150,e.canvas.height/2-70+23),e.ctx.fillText("- For every apple you will get points",e.canvas.width/2-150,e.canvas.height/2-70+69),e.ctx.fillText("- Apple will appear in every ".concat(e.delayAppleAppear/1e3,"s"),e.canvas.width/2-150,e.canvas.height/2-70+92),e.ctx.fillText("- After you will reach certain amount of points,",e.canvas.width/2-150,e.canvas.height/2-70+115),e.ctx.fillText("      the new kinds of apple will appear",e.canvas.width/2-150,e.canvas.height/2-70+138),e.ctx.lineWidth=3,e.ctx.strokeRect(e.canvas.width/2-200,e.canvas.height/2+80,400,70),e.ctx.font="30px Roboto",e.ctx.fillText("Start Game ( Enter )",e.canvas.width/2-115,e.canvas.height/2+122.5,230),window.addEventListener("keypress",e.startGameListen)},Game.prototype.checkStatus=function(){var e=this;"startGame"===e.status?e.startGame():"gameOver"===e.status?e.gameOver():"info"===e.status&&e.info()};var game=new Game;game.checkStatus();